/**
 * @file ChartPage.js
 * @description ì°¨íŠ¸ í˜ì´ì§€ - ì—¬ëŸ¬ ì¥ë¥´ì˜ ìŒì•… ì°¨íŠ¸ë¥¼ ê·¸ë¦¬ë“œë¡œ í‘œì‹œ
 * 
 * ì´ í˜ì´ì§€ì—ì„œ ë³´ì—¬ì£¼ëŠ” ë‚´ìš©:
 * - 6ê°œì˜ ì¥ë¥´ë³„ ì°¨íŠ¸ (2í–‰ 3ì—´ ê·¸ë¦¬ë“œ)
 * - ê° ì°¨íŠ¸ë‹¹ Top 10 íŠ¸ë™
 * - ìƒë‹¨ Hero ë°°ë„ˆ (1ìœ„, 2ìœ„ ê³¡ ì»¤ë²„)
 */

import React, { useEffect, useState } from 'react';

// Spotify API í•¨ìˆ˜
import { getMultiCharts } from './spotify';

// ì»´í¬ë„ŒíŠ¸
import Hero from './component/Hero';         // ìƒë‹¨ íˆì–´ë¡œ ë°°ë„ˆ
import TrackRow from './component/TrackRow'; // íŠ¸ë™ í–‰ ì•„ì´í…œ

// ìŠ¤íƒ€ì¼
import './MainPage.css';

/**
 * ChartPage ì»´í¬ë„ŒíŠ¸
 * 
 * ì—¬ëŸ¬ ì¥ë¥´ì˜ ì°¨íŠ¸ë¥¼ í•œ í˜ì´ì§€ì— ëª¨ì•„ì„œ ë³´ì—¬ì£¼ëŠ” ì»´í¬ë„ŒíŠ¸
 * 
 * @component
 * @param {Object} props
 * @param {Function} props.onTrackClick - íŠ¸ë™ í´ë¦­ ì‹œ í˜¸ì¶œë˜ëŠ” í•¸ë“¤ëŸ¬ (ëª¨ë‹¬ ì—´ê¸°)
 * @returns {JSX.Element} ì°¨íŠ¸ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
 */
function ChartPage({ onTrackClick }) {
    // ============================================================
    // ======================== ìƒíƒœ ì •ì˜ ==========================
    // ============================================================

    /**
     * ì°¨íŠ¸ ë°ì´í„° ë°°ì—´
     * @type {Array<{title: string, tracks: Track[]}>}
     * 
     * ê° ì°¨íŠ¸ ê°ì²´ì—ëŠ”:
     * - title: ì°¨íŠ¸ ì œëª© (ì˜ˆ: "ğŸ”¥ ì§€ê¸ˆ ëœ¨ëŠ” K-Pop")
     * - tracks: í•´ë‹¹ ì°¨íŠ¸ì˜ íŠ¸ë™ ë°°ì—´ (ìµœëŒ€ 10ê°œ)
     */
    const [charts, setCharts] = useState([]);

    /**
     * ë¡œë”© ìƒíƒœ
     * @type {boolean}
     */
    const [loading, setLoading] = useState(true);

    // ============================================================
    // ===================== ë°ì´í„° ë¡œë”© ===========================
    // ============================================================

    /**
     * ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ ì°¨íŠ¸ ë°ì´í„° ë¡œë“œ
     * 
     * getMultiCharts()ëŠ” ëœë¤ìœ¼ë¡œ 6ê°œ ì¥ë¥´ì˜ ì°¨íŠ¸ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
     * ê° ì°¨íŠ¸ì—ëŠ” í•´ë‹¹ ì¥ë¥´ì˜ Top 10 íŠ¸ë™ì´ í¬í•¨ë©ë‹ˆë‹¤.
     */
    useEffect(() => {
        const fetchData = async () => {
            setLoading(true);

            // Spotify APIì—ì„œ ë‹¤ì¤‘ ì°¨íŠ¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const data = await getMultiCharts();
            setCharts(data);

            setLoading(false);
        };
        fetchData();
    }, []);  // ë¹ˆ ë°°ì—´ = ë§ˆìš´íŠ¸ ì‹œ 1íšŒë§Œ ì‹¤í–‰

    // ============================================================
    // ===================== ë¡œë”© ìƒíƒœ ì²˜ë¦¬ ========================
    // ============================================================

    /**
     * ë¡œë”© ì¤‘ì¼ ë•Œ í‘œì‹œ
     * 
     * ì „ì²´ í™”ë©´ì„ ì±„ìš°ëŠ” ë¡œë”© ë©”ì‹œì§€ í‘œì‹œ
     */
    if (loading) {
        return (
            <div className="main-page-loading" style={{ height: '100vh', display: 'flex', justifyContent: 'center', alignItems: 'center' }}>
                Loading Charts...
            </div>
        );
    }

    // ============================================================
    // ===================== ë Œë”ë§ ì¤€ë¹„ ===========================
    // ============================================================

    /**
     * Hero ì»´í¬ë„ŒíŠ¸ìš© ì•¨ë²” ì»¤ë²„
     * 
     * ì²« ë²ˆì§¸ ì°¨íŠ¸ì˜ 1ìœ„, 2ìœ„ ê³¡ ì»¤ë²„ë¥¼ ì‚¬ìš©
     */
    const firstChart = charts.length > 0 ? charts[0] : null;
    const cover1 = firstChart?.tracks[0]?.cover; // 1ìœ„ ê³¡ ì»¤ë²„
    const cover2 = firstChart?.tracks[1]?.cover; // 2ìœ„ ê³¡ ì»¤ë²„

    // ============================================================
    // ========================= ë Œë”ë§ ============================
    // ============================================================

    return (
        <div className="chart-page">
            {/* ========== ìƒë‹¨ Hero ì„¹ì…˜ ========== */}
            {/* ì²« ë²ˆì§¸ ì°¨íŠ¸ì˜ íƒ€ì´í‹€ì„ Heroì— ì „ë‹¬ (ì˜µì…˜) */}
            {charts.length > 0 && (
                <Hero
                    onSearchClick={() => { }}  // ê²€ìƒ‰ ë²„íŠ¼ ë¹„í™œì„±í™” (ì°¨íŠ¸ í˜ì´ì§€ì—ì„œëŠ” ë¶ˆí•„ìš”)
                    title="OSS MUSIC CHARTS"  // ê³ ì • ì œëª©
                    cover1={cover1}           // 1ìœ„ ì•¨ë²” ì»¤ë²„
                    cover2={cover2}           // 2ìœ„ ì•¨ë²” ì»¤ë²„
                />
            )}

            {/* ========== ì°¨íŠ¸ ê·¸ë¦¬ë“œ ì»¨í…Œì´ë„ˆ ========== */}
            {/* 
              CSS í´ë˜ìŠ¤ charts-gridëŠ” MainPage.cssì—ì„œ ì •ì˜
              2í–‰ 3ì—´ì˜ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ
            */}
            <div className="charts-grid">
                {charts.map((chart, chartIndex) => (
                    /**
                     * ê°œë³„ ì°¨íŠ¸ ì¹´ë“œ
                     * 
                     * ê° ì°¨íŠ¸ëŠ” ì¹´ë“œ í˜•íƒœë¡œ í‘œì‹œë˜ë©°
                     * ì œëª©ê³¼ íŠ¸ë™ ë¦¬ìŠ¤íŠ¸ë¥¼ í¬í•¨
                     */
                    <section key={chartIndex} className="chart-card">
                        {/* ì°¨íŠ¸ ì œëª© (ì˜ˆ: ğŸ”¥ ì§€ê¸ˆ ëœ¨ëŠ” K-Pop) */}
                        <h2 className="chart-title">
                            {chart.title}
                        </h2>

                        {/* íŠ¸ë™ ë¦¬ìŠ¤íŠ¸ */}
                        <ul className="mini-track-list">
                            {chart.tracks.map((track, i) => (
                                <TrackRow
                                    key={track.id}            // React ë¦¬ìŠ¤íŠ¸ key
                                    track={track}             // íŠ¸ë™ ë°ì´í„°
                                    rank={i + 1}              // ìˆœìœ„ (1ë¶€í„° ì‹œì‘)
                                    showAlbumInfo={false}     // ê³µê°„ì´ ì¢ìœ¼ë‹ˆ ì•¨ë²” ì •ë³´ëŠ” ìˆ¨ê¹€
                                    onClick={() => onTrackClick(track)}  // í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸°
                                />
                            ))}
                        </ul>
                    </section>
                ))}
            </div>
        </div>
    );
}

export default ChartPage;